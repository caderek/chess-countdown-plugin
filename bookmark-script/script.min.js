(()=>{const r=document.location.pathname.split("/").includes("tv");var e=e=>{const o={move:[],"move-every":[],every:[],unique:[]};return e.forEach(e=>{if(5===e.length)o.unique.push(e);else{const[n,a]=e.split(" ");var[t,e]=a.split(":").map(Number),e=60*t+e;o[n].push(e)}}),o};let i={active:!0,lang:"en-US",voice:null,volume:25,rate:0,sayMomentsBullet:e(["move 00:05","every 00:30","00:45","00:15"]),sayMomentsBlitz:e(["move 00:10","every 01:00","00:45","00:30","00:15"]),sayMomentsRapid:e(["move 00:20","every 02:00","01:00","00:45","00:30","00:15"]),sayMomentsClassical:e(["move 01:00","every 05:00","01:00","00:45","00:30","00:15"]),saySeconds:!0,countdownWhen:5,readPlayer1:!0,readPlayer2:!0,readTime:!0,tab:"Bullet"},a=!1,o=!1,m="Bullet",u=0,d=!1;const t={"en-US":{min:e=>1===e?"minute":"minutes",sec:e=>1===e?"second":"seconds",moves:{x:" takes ","+":" check","#":" mate","=":" promotes ",P:"pawn ",R:"rook ",B:"bishop ",N:"knight ",Q:"queen ",K:"king ","O-O":"short castle","O-O-O":"long castle"},alerts:{move:"Move!"}}},v=(e,t)=>{const n=new MutationObserver(t);n.observe(e,{attributes:!1,childList:!0,subtree:!0})},y=e=>t[e]||t["en-US"],h=e=>{var t=Number(e.childNodes[0].data),n=Number(e.childNodes[2].data),e=(e=n,[String(t).padStart(2,"0"),String(e).padStart(2,"0")].join(":"));return[t,n,e]},p=(e,t)=>{if(!a){const n=new SpeechSynthesisUtterance(e);n.volume=i.volume/100,n.lang=i.lang,n.voice=t.find(e=>e.name===i.voice),n.rate=1+i.rate/10,speechSynthesis.speak(n)}};document.addEventListener("keydown",e=>{switch(e.key){case"m":a=!a;break;case"t":document.querySelector(".main-board").classList.toggle("blindfold");break;case"T":const t=document.querySelector(".main-board"),n=document.querySelector("rm6");o=!o,o?(t.style.opacity=0,n.style.opacity=0):(t.style.opacity=1,n.style.opacity=1)}}),(()=>{console.log("Starting Lichess Speaker...");var e=document.querySelectorAll(".time")[1],t=document.querySelector("rm6");const n=document.querySelector(".setup");var a,o=speechSynthesis.getVoices();n&&(a=n.innerText.match(/Bullet|Blitz|Rapid|Classical/i),m=a?a[0]:m),t&&((e,o)=>{let s=0;const l=document.querySelector(".orientation-black")?"black":"white",c="black"==l?"white":"black";v(e,()=>{const t=y(i.lang).moves||y("en-US").moves;var n=e.querySelectorAll("u8t"),a=n.length%2==0?"black":"white";if(n.length>s&&(u=0,d=a==c),(a!=l||i.readPlayer1)&&(a!=c||i.readPlayer2)&&i.active&&n.length>s){let e=n[n.length-1].innerText;e="O-O"===e||"O-O-O"===e?t[e]:((a=e.match(/[a-h1-8][a-h][1-8]/))&&(e=e.replace(a[0],`${a[0][0]} ${a[0][1]}${a[0][2]}`)),e.split("").map(e=>t[e]||e).join("").replace(/\s{2,}/g," ")),p(e,o),s=n.length}})})(t,o),e&&((s,l)=>{let c=null;v(s,()=>{var[t,n,e]=h(s);const a=60*t+n;if(n!==c&&i.active&&i.readTime){if(0===t&&n<=i.countdownWhen&&0<i.countdownWhen)return p(n,l),void(c=n);const o=i[`sayMoments${m}`];if(o.unique.includes(e)||o.every.some(e=>a%e==0)){t=0<t?`${t} ${y(i.lang).min(t)},`:"";let e="";0<n&&(e=`${n}`,i.saySeconds&&(e+=` ${y(i.lang).sec(n)}`));t=`${t} ${e}`;p(t,l)}d&&!r&&(u++,(o.move.includes(u)||o["move-every"].some(e=>u%e==0))&&p(y(i.lang).alerts.move,l)),c=n}else c=n})})(e,o)})()})();
